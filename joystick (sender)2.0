#include <WiFi.h>
#include <esp_now.h>

uint8_t broadcastAddress[] = {0xFF,0xFF,0xFF,0xFF,0xFF,0xFF};

typedef struct {
  int joy1_x;
  int joy2_y;
} JoyData;

JoyData data;

void onSend(const wifi_tx_info_t *info, esp_now_send_status_t status) {
  Serial.println(status == ESP_NOW_SEND_SUCCESS ? "Sent OK" : "Send FAIL");
}

void setup() {
  Serial.begin(115200);
  WiFi.mode(WIFI_STA);

  esp_now_init();
  esp_now_register_send_cb(onSend);

  esp_now_peer_info_t peer = {};
  memcpy(peer.peer_addr, broadcastAddress, 6);
  esp_now_add_peer(&peer);

  pinMode(2, INPUT);
  pinMode(1, INPUT);

  Serial.println("Sender ready");
}

void loop() {
  data.joy1_x = analogRead(2);
  data.joy2_y = analogRead(1);

  esp_now_send(broadcastAddress, (uint8_t *)&data, sizeof(data));

  Serial.print("Joy1 X: ");
  Serial.print(data.joy1_x);
  Serial.print(" | Joy2 Y: ");
  Serial.println(data.joy2_y);

  delay(100);
}
